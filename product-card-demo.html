<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Card Block Demo</title>
    <link rel="stylesheet" href="styles/styles.css">
    <link rel="stylesheet" href="blocks/product-card/product-card.css">
    <style>
        body {
            margin: 0;
            padding: 2rem;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #ffffff;
            color: #333;
        }
        
        .demo-section {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 0;
        }
        
        .demo-title {
            text-align: center;
            font-size: 2rem;
            margin-bottom: 3rem;
            color: #212529;
        }
        
        .demo-description {
            text-align: center;
            font-size: 1.125rem;
            color: #6c757d;
            margin-bottom: 3rem;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .config-demo {
            background: #f8f9fa;
            padding: 2rem;
            border-radius: 8px;
            margin-bottom: 3rem;
        }
        
        .config-demo h3 {
            margin-top: 0;
            color: #495057;
        }
        
        .config-demo table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.875rem;
        }
        
        .config-demo th,
        .config-demo td {
            padding: 0.5rem;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }
        
        .config-demo th {
            background: #e9ecef;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="demo-section">
        <h1 class="demo-title">Product Card Block Demo</h1>
        <p class="demo-description">
            This EDS block displays product cards in a carousel format with configurable settings. 
            It fetches data from a mock GraphQL API and supports Universal Editor authoring.
        </p>
        
        <div class="config-demo">
            <h3>Block Configuration</h3>
            <table>
                <thead>
                    <tr>
                        <th>Setting</th>
                        <th>Value</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Item Count</td>
                        <td>3</td>
                        <td>Number of products to display (configurable: 1-10)</td>
                    </tr>
                    <tr>
                        <td>API Endpoint</td>
                        <td>/mock-api/products</td>
                        <td>GraphQL endpoint (currently using mock data)</td>
                    </tr>
                    <tr>
                        <td>Auto-play</td>
                        <td>5000ms</td>
                        <td>Carousel auto-play interval</td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <!-- Product Card Block Demo -->
        <div class="product-card block" data-block-name="product-card">
            <div>
                <div>Item Count</div>
                <div>3</div>
            </div>
        </div>
        
        <div style="margin-top: 4rem; padding: 2rem; background: #f8f9fa; border-radius: 8px;">
            <h3>Features Included:</h3>
            <ul style="column-count: 2; gap: 2rem;">
                <li>✅ Mock GraphQL API integration</li>
                <li>✅ Responsive carousel with 3 items default</li>
                <li>✅ Universal Editor authoring support</li>
                <li>✅ Configurable number of items</li>
                <li>✅ Product image hover effects</li>
                <li>✅ Quick view functionality</li>
                <li>✅ Compare products feature</li>
                <li>✅ FPS gaming benchmarks</li>
                <li>✅ Price display with discounts</li>
                <li>✅ Specification lists</li>
                <li>✅ Auto-play carousel</li>
                <li>✅ Navigation controls</li>
                <li>✅ Loading and error states</li>
                <li>✅ Accessibility support</li>
                <li>✅ Mobile responsive design</li>
                <li>✅ Tooltip support</li>
            </ul>
        </div>
    </div>

    <!-- Mock AEM.js functions for demo -->
    <script>
        // Mock functions from aem.js and scripts.js for demo
        window.createOptimizedPicture = function(src, alt, eager, widths) {
            const img = document.createElement('img');
            img.src = src;
            img.alt = alt;
            img.loading = eager ? 'eager' : 'lazy';
            return img;
        };
        
        window.moveInstrumentation = function(from, to) {
            // Mock function - normally handles analytics instrumentation
        };
    </script>
    
    <!-- Inline the product card JavaScript for demo -->
    <script>
        // Mock GraphQL API function
        async function fetchProductData(endpoint = '/mock-api/products', limit = 3) {
          // Mock data matching the existing product card template structure
          const mockData = {
            data: {
              products: [
                {
                  id: 'rog-strix-gt15',
                  name: 'ROG Strix GT15 Gaming Desktop',
                  model: 'G15CF-DB776',
                  image: 'https://picsum.photos/300/300?random=1',
                  imageHover: 'https://picsum.photos/300/300?random=2',
                  price: '1299',
                  originalPrice: '1599',
                  discount: '300',
                  bazaarvoiceProductId: 'rog-strix-gt15',
                  benchmarkGame: 'Cyberpunk 2077',
                  fps: '85',
                  specs: [
                    'AMD Ryzen 7 5700G Processor',
                    'NVIDIA GeForce RTX 3060 Ti',
                    '16GB DDR4 RAM',
                    '512GB PCIe SSD + 1TB HDD'
                  ]
                },
                {
                  id: 'rog-strix-gt35',
                  name: 'ROG Strix GT35 Gaming Desktop',
                  model: 'G35CZ-DB796',
                  image: 'https://picsum.photos/300/300?random=3',
                  imageHover: 'https://picsum.photos/300/300?random=4',
                  price: '1899',
                  originalPrice: '2199',
                  discount: '300',
                  bazaarvoiceProductId: 'rog-strix-gt35',
                  benchmarkGame: 'Call of Duty: Modern Warfare III',
                  fps: '120',
                  specs: [
                    'Intel Core i7-11700KF Processor',
                    'NVIDIA GeForce RTX 3070',
                    '32GB DDR4 RAM',
                    '1TB PCIe SSD'
                  ]
                },
                {
                  id: 'rog-strix-ga15',
                  name: 'ROG Strix GA15 Gaming Desktop',
                  model: 'G15DK-DB756',
                  image: 'https://picsum.photos/300/300?random=5',
                  imageHover: 'https://picsum.photos/300/300?random=6',
                  price: '999',
                  originalPrice: '1299',
                  discount: '300',
                  bazaarvoiceProductId: 'rog-strix-ga15',
                  benchmarkGame: 'Fortnite Chapter 5',
                  fps: '165',
                  specs: [
                    'AMD Ryzen 5 5600G Processor',
                    'NVIDIA GeForce RTX 3060',
                    '16GB DDR4 RAM',
                    '512GB PCIe SSD'
                  ]
                }
              ]
            }
          };

          // Simulate API delay
          await new Promise(resolve => setTimeout(resolve, 500));
          
          return mockData.data.products.slice(0, limit);
        }

        // Get placeholder text
        function getPlaceholder(key) {
          const placeholders = {
            'compare': 'Compare',
            'buy-now': 'Buy now',
            'in-stock': 'In Stock',
            'new': 'New',
            'deal': 'Deal',
            'quick-view': 'Quick view',
            'estore-price': 'ASUS estore price',
            'save': 'SAVE',
            'watch-now': 'Watch now',
            'previous': 'Previous',
            'next': 'Next'
          };
          
          return placeholders[key] || key;
        }

        // Create product card HTML
        function createProductCard(product) {
          const card = document.createElement('div');
          card.className = 'cmp-product-card';
          
          card.innerHTML = `
            <div class="cmp-product-card__header">
              <div class="cmp-product-card__status">
                <span class="cmp-product-card__status-item cmp-product-card__status--in-stock">${getPlaceholder('in-stock')}</span>
                <span class="cmp-product-card__status-item cmp-product-card__status--new">${getPlaceholder('new')}</span>
                <span class="cmp-product-card__status-item cmp-product-card__status--deal">${getPlaceholder('deal')}</span>
              </div>
            </div>

            <div class="cmp-product-card__body">
              <div class="cmp-product-card__image cmp-image">
                <button class="cmp-product-card__preview-btn" data-a11y-dialog-show="product-preview-dialog" aria-label="${getPlaceholder('quick-view')} ${product.name}">${getPlaceholder('quick-view')}</button>
                <img class="cmp-image__image" src="${product.image}" alt="${product.name}" loading="lazy" />
                ${product.imageHover ? `<img class="cmp-image__image--hover" src="${product.imageHover}" alt="${product.name}" aria-hidden="true" loading="lazy" />` : ''}
              </div>

              <div class="cmp-product-card__info">
                <div class="cmp-product-card__title">
                  <a href="#" aria-label="${getPlaceholder('buy-now')} ${product.name}">${product.name}</a>
                </div>
                <p class="cmp-product-card__model">
                  <a href="#" onclick="event.preventDefault()">${product.model}</a>
                </p>
              </div>

              <div class="cmp-product-card__rating_and_compare">
                <div class="cmp-product-card__rating">
                  <div
                    data-bv-show="inline_rating"
                    data-bv-product-id="${product.bazaarvoiceProductId}"
                    data-bv-redirect-url="#product-reviews"
                  ></div>
                </div>
                <div class="cmp-product-card__compare">
                  <input type="checkbox" class="cmp-product-card__compare-checkbox" id="compare-${product.id}" data-id="${product.id}"
                    data-name="${product.name}" data-model="${product.model}" data-sku="${product.model}" data-image="${product.image}"
                    data-pdp="/product-detail/${product.id}" data-add-to-compare />

                  <label for="compare-${product.id}" class="cmp-product-card__compare-label">${getPlaceholder('compare')}</label>
                </div>
              </div>

              <div class="cmp-product-card__fps">
                <p class="cmp-product-card__fps-game">
                  ${product.benchmarkGame}
                </p>

                <button class="cmp-product-card__fps-score" data-tooltip-trigger aria-describedby="fps-details-${product.id}" data-tooltip-position="right">
                    FPS: ${product.fps}
                </button>
                <div id="fps-details-${product.id}" class="tooltip__content" role="tooltip">
                  <table class="cmp-product-card__fps-table">
                    <thead>
                      <tr>
                        <th>Game FPS</th>
                        <th>1080P</th>
                        <th>1440P</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td>Call of Duty: Modern Warfare III</td>
                        <td>--</td>
                        <td>57 FPS</td>
                      </tr>
                      <tr>
                        <td>Fortnite Chapter 4</td>
                        <td>346 FPS</td>
                        <td>45 FPS</td>
                      </tr>
                      <tr>
                        <td>Red Dead Redemption 2</td>
                        <td>315 FPS</td>
                        <td>--</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>

              <ul class="cmp-product-card__specs">
                ${product.specs.map(spec => `<li class="cmp-product-card__spec-item">${spec}</li>`).join('')}
              </ul>

              <div class="cmp-product-card__estore">
                <div class="cmp-product-card__estore-line">
                  <span class="cmp-product-card__estore-label">${getPlaceholder('estore-price')}</span>

                  <div class="cmp-product-card__estore-icon-wrapper">
                    <button class="cmp-product-card__estore-icon" data-tooltip-trigger aria-describedby="estore-price-info-${product.id}" data-tooltip-position="top" aria-label="Information about ASUS estore price.">
                      <span class="visually-hidden"></span>
                    </button>
                    <div class="cmp-product-card__tooltip tooltip__content" id="estore-price-info-${product.id}" role="tooltip">
                      ASUS estore price is the price of a product provided by ASUS estore. Specifications listed here may not be
                      available on estore and are for reference only.
                    </div>
                  </div>
                </div>
              </div>

              <div class="cmp-product-card__price-block">
                <span class="cmp-product-card__price">$${product.price}</span>
                <span class="cmp-product-card__original-price">$${product.originalPrice}</span>
                <span class="cmp-product-card__discount">${getPlaceholder('save')} $${product.discount}</span>
              </div>
            </div>

            <div class="cmp-product-card__footer">
              <button class="cmp-button cmp-product-card__buy-button btn" onclick="alert('Buy now clicked for ${product.name}')">${getPlaceholder('buy-now')}</button>
            </div>
          `;
          
          return card;
        }

        // Initialize carousel functionality
        function initializeCarousel(carousel, products) {
          const content = carousel.querySelector('.cmp-carousel__content');
          const prevBtn = carousel.querySelector('.cmp-carousel__action--previous');
          const nextBtn = carousel.querySelector('.cmp-carousel__action--next');
          const indicators = carousel.querySelector('.cmp-carousel__indicators');
          
          let currentIndex = 0;
          
          // Create indicators
          products.forEach((_, index) => {
            const indicator = document.createElement('li');
            indicator.innerHTML = `<button type="button" role="tab" aria-controls="carousel-item-${index}" aria-selected="${index === 0 ? 'true' : 'false'}" tabindex="${index === 0 ? '0' : '-1'}">${index + 1}</button>`;
            indicator.addEventListener('click', () => goToSlide(index));
            indicators.appendChild(indicator);
          });
          
          function updateCarousel() {
            const items = content.querySelectorAll('.cmp-carousel__item');
            const indicatorButtons = indicators.querySelectorAll('button');
            
            items.forEach((item, index) => {
              item.classList.toggle('cmp-carousel__item--active', index === currentIndex);
              item.setAttribute('aria-hidden', index !== currentIndex);
            });
            
            indicatorButtons.forEach((btn, index) => {
              btn.setAttribute('aria-selected', index === currentIndex);
              btn.setAttribute('tabindex', index === currentIndex ? '0' : '-1');
            });
            
            content.style.transform = `translateX(-${currentIndex * 100}%)`;
          }
          
          function goToSlide(index) {
            currentIndex = index;
            updateCarousel();
          }
          
          function nextSlide() {
            currentIndex = (currentIndex + 1) % products.length;
            updateCarousel();
          }
          
          function prevSlide() {
            currentIndex = (currentIndex - 1 + products.length) % products.length;
            updateCarousel();
          }
          
          prevBtn.addEventListener('click', prevSlide);
          nextBtn.addEventListener('click', nextSlide);
          
          // Auto-play functionality
          let autoPlayInterval = setInterval(nextSlide, 5000);
          
          carousel.addEventListener('mouseenter', () => clearInterval(autoPlayInterval));
          carousel.addEventListener('mouseleave', () => {
            autoPlayInterval = setInterval(nextSlide, 5000);
          });
          
          updateCarousel();
        }

        // Main decorate function
        async function decorateProductCard(block) {
          // Get configuration from block data
          const config = {};
          const rows = [...block.children];
          
          rows.forEach(row => {
            const cells = [...row.children];
            if (cells.length >= 2) {
              const key = cells[0].textContent.trim().toLowerCase().replace(/\s+/g, '-');
              const value = cells[1].textContent.trim();
              config[key] = value;
            }
          });
          
          // Get number of items to display (default: 3)
          const itemCount = parseInt(config['item-count'] || config['items'] || '3', 10);
          
          // Show loading state
          block.innerHTML = '<div class="product-card-loading">Loading products...</div>';
          
          try {
            // Fetch product data
            const products = await fetchProductData('/mock-api/products', itemCount);
            
            if (!products || products.length === 0) {
              block.innerHTML = '<div class="product-card-error">No products found.</div>';
              return;
            }
            
            // Create simple grid layout instead of complex carousel
            const container = document.createElement('div');
            container.className = 'product-card-carousel';
            container.innerHTML = `
              <div class="cmp-carousel">
                <div class="cmp-carousel__content">
                  ${products.map(product => `
                    <div class="cmp-carousel__item">
                      ${createProductCard(product).outerHTML}
                    </div>
                  `).join('')}
                </div>
                <div class="cmp-carousel__indicators">
                  ${products.map((_, index) => `
                    <button type="button" class="indicator ${index === 0 ? 'active' : ''}">${index + 1}</button>
                  `).join('')}
                </div>
              </div>
            `;
            
            // Replace block content
            block.textContent = '';
            block.appendChild(container);
            
          } catch (error) {
            console.error('Error loading product cards:', error);
            block.innerHTML = '<div class="product-card-error">Error loading products. Please try again later.</div>';
          }
        }
        
        // Initialize product card blocks
        document.addEventListener('DOMContentLoaded', () => {
            const productCardBlocks = document.querySelectorAll('.product-card.block');
            productCardBlocks.forEach(block => {
                decorateProductCard(block);
            });
        });
    </script>
</body>
</html>
