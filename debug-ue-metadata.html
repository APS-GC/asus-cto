<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Debug UE Metadata</title>
  <link rel="stylesheet" href="/styles/styles.css">
  <style>
    .debug-info {
      background: #f0f8ff;
      border: 2px solid #007acc;
      padding: 1rem;
      margin: 1rem 0;
      border-radius: 8px;
      font-family: monospace;
    }
    .debug-section {
      border: 2px dashed #ff6b6b;
      margin: 2rem 0;
      padding: 1rem;
      position: relative;
    }
    .debug-section::before {
      content: "DEBUG SECTION";
      position: absolute;
      top: -10px;
      left: 10px;
      background: #ff6b6b;
      color: white;
      padding: 2px 8px;
      font-size: 12px;
      font-weight: bold;
    }
    .attribute-list {
      background: #f5f5f5;
      padding: 0.5rem;
      margin: 0.5rem 0;
      border-radius: 4px;
      max-height: 200px;
      overflow-y: auto;
    }
  </style>
</head>
<body>
  <main>
    <div class="debug-info">
      <h2>üîç UE Metadata Debug Tool</h2>
      <p><strong>Instructions:</strong></p>
      <ol>
        <li>Open this page in Universal Editor</li>
        <li>Set some metadata properties on the sections below (background color, margins, padding)</li>
        <li>Save the changes</li>
        <li>Check the debug output below to see how UE stores the metadata</li>
      </ol>
      <button onclick="debugMetadata()">üîÑ Refresh Debug Info</button>
    </div>

    <div class="debug-section" id="test-section-1">
      <h3>Test Section 1</h3>
      <p>Set some metadata on this section in UE, then click "Refresh Debug Info" to see how it's stored.</p>
      <div id="debug-section-1" class="attribute-list"></div>
    </div>

    <div class="debug-section" id="test-section-2">
      <h3>Test Section 2</h3>
      <p>Set different metadata on this section to compare how different values are stored.</p>
      <div id="debug-section-2" class="attribute-list"></div>
    </div>

    <div class="debug-section" id="test-section-3">
      <h3>Test Section 3</h3>
      <p>Another test section for comparison.</p>
      <div id="debug-section-3" class="attribute-list"></div>
    </div>

    <div class="debug-info">
      <h3>üìã Debug Output</h3>
      <div id="debug-output">
        <p>Click "Refresh Debug Info" to see metadata information...</p>
      </div>
    </div>

    <div class="debug-info">
      <h3>üéØ Expected Values</h3>
      <p><strong>Background Colors:</strong> bg-white, bg-black, bg-primary, bg-primary-900, bg-info, etc.</p>
      <p><strong>Margins:</strong> mt-1, mt-4, mt-8, mt-12, mt-16, mt-20, mt-24 (and mb- variants)</p>
      <p><strong>Padding:</strong> pt-1, pt-4, pt-8, pt-12, pt-16, pt-20, pt-24 (and pb- variants)</p>
      <p><strong>Styles:</strong> highlight, full-width, text-center</p>
    </div>
  </main>

  <script>
    function debugMetadata() {
      console.log('=== UE METADATA DEBUG ===');
      
      const sections = document.querySelectorAll('.debug-section');
      let debugHtml = '<h4>Debug Results:</h4>';
      
      sections.forEach((section, index) => {
        const sectionNum = index + 1;
        console.log(`\n--- Section ${sectionNum} (${section.id}) ---`);
        
        // Get all attributes
        const attributes = {};
        for (let attr of section.attributes) {
          attributes[attr.name] = attr.value;
          console.log(`${attr.name}: "${attr.value}"`);
        }
        
        // Get all data attributes specifically
        const dataAttributes = {};
        for (let key in section.dataset) {
          dataAttributes[key] = section.dataset[key];
          console.log(`dataset.${key}: "${section.dataset[key]}"`);
        }
        
        // Get classes
        const classes = Array.from(section.classList);
        console.log(`classes: [${classes.join(', ')}]`);
        
        // Check for section-metadata div
        const sectionMeta = section.querySelector('div.section-metadata');
        let metadataDiv = null;
        if (sectionMeta) {
          metadataDiv = sectionMeta.outerHTML;
          console.log('section-metadata div found:', metadataDiv);
        }
        
        // Update the debug display for this section
        const debugDiv = document.getElementById(`debug-section-${sectionNum}`);
        debugDiv.innerHTML = `
          <strong>All Attributes:</strong><br>
          ${Object.entries(attributes).map(([k,v]) => `${k}: "${v}"`).join('<br>') || 'None'}
          <br><br>
          <strong>Data Attributes:</strong><br>
          ${Object.entries(dataAttributes).map(([k,v]) => `data-${k}: "${v}"`).join('<br>') || 'None'}
          <br><br>
          <strong>CSS Classes:</strong><br>
          ${classes.join(', ') || 'None'}
          <br><br>
          <strong>Section Metadata DIV:</strong><br>
          ${metadataDiv || 'None found'}
        `;
        
        // Add to main debug output
        debugHtml += `
          <div style="border: 1px solid #ddd; margin: 0.5rem 0; padding: 0.5rem;">
            <strong>Section ${sectionNum} (${section.id}):</strong><br>
            Classes: ${classes.join(', ') || 'None'}<br>
            Data attrs: ${Object.keys(dataAttributes).length ? Object.entries(dataAttributes).map(([k,v]) => `${k}="${v}"`).join(', ') : 'None'}<br>
            All attrs: ${Object.keys(attributes).length ? Object.entries(attributes).map(([k,v]) => `${k}="${v}"`).join(', ') : 'None'}
          </div>
        `;
      });
      
      // Check body for page-level metadata
      console.log('\n--- Body Element ---');
      const bodyAttrs = {};
      for (let attr of document.body.attributes) {
        bodyAttrs[attr.name] = attr.value;
        console.log(`body.${attr.name}: "${attr.value}"`);
      }
      
      const bodyClasses = Array.from(document.body.classList);
      console.log(`body classes: [${bodyClasses.join(', ')}]`);
      
      // Check for meta tags
      console.log('\n--- Meta Tags ---');
      const metaTags = document.querySelectorAll('meta[name*="background"], meta[name*="margin"], meta[name*="padding"], meta[property*="background"], meta[property*="margin"], meta[property*="padding"]');
      metaTags.forEach(meta => {
        const attr = meta.hasAttribute('name') ? 'name' : 'property';
        console.log(`meta[${attr}="${meta.getAttribute(attr)}"]: "${meta.content}"`);
      });
      
      debugHtml += `
        <div style="border: 1px solid #ddd; margin: 0.5rem 0; padding: 0.5rem;">
          <strong>Body Element:</strong><br>
          Classes: ${bodyClasses.join(', ') || 'None'}<br>
          Attributes: ${Object.entries(bodyAttrs).map(([k,v]) => `${k}="${v}"`).join(', ') || 'None'}
        </div>
      `;
      
      document.getElementById('debug-output').innerHTML = debugHtml;
      
      console.log('=== END DEBUG ===');
    }
    
    // Auto-debug on load
    document.addEventListener('DOMContentLoaded', () => {
      setTimeout(debugMetadata, 1000);
    });
    
    // Debug when UE makes changes
    if (typeof window !== 'undefined') {
      document.addEventListener('aue:content-patch', () => {
        console.log('UE content patch detected, refreshing debug...');
        setTimeout(debugMetadata, 500);
      });
      
      document.addEventListener('aue:content-update', () => {
        console.log('UE content update detected, refreshing debug...');
        setTimeout(debugMetadata, 500);
      });
    }
  </script>
</body>
</html>
