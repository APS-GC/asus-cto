<meta name="viewport" content="width=device-width, initial-scale=1"/>
<script src="/scripts/aem.js" type="module"></script>
<script src="/scripts/scripts.js" type="module"></script>
<link rel="stylesheet" href="/styles/styles.css"/>
<!--<link rel="stylesheet" href="/styles/site.css"/>-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/Swiper/11.0.5/swiper-bundle.min.js" integrity="sha512-Ysw1DcK1P+uYLqprEAzNQJP+J4hTx4t/3X2nbVwszao8wD+9afLjBQYjz7Uk4ADP+Er++mJoScI42ueGtQOzEA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

<!-- Dynamic SEO Meta Tags -->
<script type="module">
  // Import getMetadata function from aem.js
  import { getMetadata } from '/scripts/aem.js';
  
  // Function to create and append meta tag
  function createMetaTag(name, content, type = 'name') {
    if (!content) return;
    
    const existingMeta = document.querySelector(`meta[${type}="${name}"]`);
    if (existingMeta) {
      existingMeta.content = content;
    } else {
      const meta = document.createElement('meta');
      meta.setAttribute(type, name);
      meta.content = content;
      document.head.appendChild(meta);
    }
  }
  
  // Function to create and append link tag
  function createLinkTag(rel, href) {
    if (!href) return;
    
    const existingLink = document.querySelector(`link[rel="${rel}"]`);
    if (existingLink) {
      existingLink.href = href;
    } else {
      const link = document.createElement('link');
      link.rel = rel;
      link.href = href;
      document.head.appendChild(link);
    }
  }
  
  // Function to set HTML lang attribute
  function setPageLanguage(lang) {
    if (!lang) return;
    document.documentElement.lang = lang;
  }
  
  // Function to add JSON-LD structured data
  function addStructuredData(data) {
    const script = document.createElement('script');
    script.type = 'application/ld+json';
    script.textContent = JSON.stringify(data);
    document.head.appendChild(script);
  }
  
  // Wait for DOM to be ready
  document.addEventListener('DOMContentLoaded', () => {
    // Get page metadata
    const title = getMetadata('jcr:title') || document.title;
    const description = getMetadata('jcr:description');
    const keywords = getMetadata('keywords');
    const canonicalUrl = getMetadata('canonicalUrl');
    const pageLanguage = getMetadata('pageLanguage');
    const robots = getMetadata('robots');
    const author = getMetadata('author');
    const ogImage = getMetadata('ogImage');
    const ogImageAlt = getMetadata('ogImageAlt');
    const ogType = getMetadata('ogType') || 'website';
    const pageVideo = getMetadata('pageVideo');
    const videoTrack = getMetadata('videoTrack');
    const videoDescription = getMetadata('videoDescription');
    const publishDate = getMetadata('publishDate');
    const modifiedDate = getMetadata('modifiedDate');
    
    // Set page language
    setPageLanguage(pageLanguage);
    
    // Basic SEO meta tags
    createMetaTag('description', description);
    createMetaTag('keywords', keywords);
    createMetaTag('robots', robots || 'index,follow');
    createMetaTag('author', author);
    
    // Canonical URL
    createLinkTag('canonical', canonicalUrl || window.location.href);
    
    // Open Graph meta tags
    createMetaTag('og:title', title, 'property');
    createMetaTag('og:description', description, 'property');
    createMetaTag('og:type', ogType, 'property');
    createMetaTag('og:url', canonicalUrl || window.location.href, 'property');
    createMetaTag('og:site_name', 'ASUS', 'property');
    
    if (ogImage) {
      createMetaTag('og:image', ogImage, 'property');
      createMetaTag('og:image:alt', ogImageAlt || title, 'property');
      createMetaTag('og:image:width', '1200', 'property');
      createMetaTag('og:image:height', '630', 'property');
    }
    
    // Video meta tags
    if (pageVideo) {
      createMetaTag('og:video', pageVideo, 'property');
      createMetaTag('og:video:type', 'video/mp4', 'property');
      if (videoDescription) {
        createMetaTag('video:description', videoDescription, 'property');
      }
    }
    
    // Twitter Card meta tags
    createMetaTag('twitter:card', ogImage ? 'summary_large_image' : 'summary');
    createMetaTag('twitter:title', title);
    createMetaTag('twitter:description', description);
    if (ogImage) {
      createMetaTag('twitter:image', ogImage);
      createMetaTag('twitter:image:alt', ogImageAlt || title);
    }
    
    // Article-specific meta tags
    if (ogType === 'article') {
      if (publishDate) {
        createMetaTag('article:published_time', publishDate, 'property');
      }
      if (modifiedDate) {
        createMetaTag('article:modified_time', modifiedDate, 'property');
      }
      if (author) {
        createMetaTag('article:author', author, 'property');
      }
    }
    
    // Structured Data (JSON-LD)
    const structuredData = {
      "@context": "https://schema.org",
      "@type": ogType === 'article' ? 'Article' : 'WebPage',
      "name": title,
      "headline": title,
      "description": description,
      "url": canonicalUrl || window.location.href,
      "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": canonicalUrl || window.location.href
      }
    };
    
    if (author) {
      structuredData.author = {
        "@type": "Person",
        "name": author
      };
    }
    
    if (publishDate) {
      structuredData.datePublished = publishDate;
    }
    
    if (modifiedDate) {
      structuredData.dateModified = modifiedDate;
    }
    
    if (ogImage) {
      structuredData.image = {
        "@type": "ImageObject",
        "url": ogImage,
        "width": 1200,
        "height": 630
      };
    }
    
    if (pageVideo) {
      structuredData.video = {
        "@type": "VideoObject",
        "contentUrl": pageVideo,
        "description": videoDescription || title,
        "name": title
      };
      
      if (videoTrack) {
        structuredData.video.caption = videoTrack;
      }
    }
    
    // Add publisher information
    structuredData.publisher = {
      "@type": "Organization",
      "name": "ASUS",
      "logo": {
        "@type": "ImageObject",
        "url": "/icons/asus-logo.svg"
      }
    };
    
    addStructuredData(structuredData);
    
    // Handle page background color from metadata
    const pageBackgroundColor = getMetadata('pageBackgroundColor');
    if (pageBackgroundColor) {
      document.body.classList.add(pageBackgroundColor);
    }
  });
</script>
