@use "../../../site/scss/settings/mixins" as mix;
@use "../../../site/scss/settings/typography" as typo;
@use "../../../site/scss/settings/variables" as vars;

.spacing-to-top {
  @include mix.m(1, "b");
}
.cmp-hero__title {
  @include typo.text-display2();
  @include mix.m(2, "b");
}

.cmp-hero__subtitle {
  @include typo.text-base();
  @include mix.m(0);
}

.cmp-sidebar {
  background: var(--color-primary-50);
  color: var(--color-primary-100);
  border-radius: vars.$border-radius-xl;
  backdrop-filter: blur(20px);
  @include mix.m(8, "t");
  @include mix.p(6);

  /* ----- Sticky Actions ----- */
  .cmp-sidebar__actions {
    display: none; // hidden by default (desktop)
  }

  .cmp-mobile--header {
    display: none; // hide on desktop
  }

  .cmp-sidebar__info {
    @include mix.m(9, "b");

    .cmp-sidebar__note {
      display: flex;
      align-items: flex-start;
      color: var(--color-primary-700);
      @include typo.text-small();
      @include mix.spacer("gap", 2);

      .icon {
        position: relative;
        top: 2px;
        flex-shrink: 0;
      }
    }
  }

  .cmp-sidebar__applied-filters {
    @include mix.m(9, "b");
    display: none;

    &.show {
      display: block;
    }

    .applied-filters__header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      @include mix.m(5, "b");

      .applied-filters__title {
        color: var(--color-primary-950);
        @include typo.text-small();
      }

      .applied-filters__clear {
        display: inline-flex;
        align-items: center;
        justify-content: flex-end;
        background: none;
        border: none;
        color: var(--color-primary-950);
        cursor: pointer;
        position: relative;
        @include typo.text-small();
        margin-left: auto;
        @include mix.p(2, "y");
        @include mix.p(5, "r");
        @include mix.p(2, "l");

        &::after {
          content: "";
          position: absolute;
          right: 0px;
          top: 50%;
          transform: translateY(-50%);
          width: 20px;
          height: 20px;
          background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 20 20' fill='none'><path d='M9.16667 17.0255C7.60361 16.8224 6.31007 16.1339 5.28604 14.9599C4.26201 13.7857 3.75 12.4101 3.75 10.8332C3.75 9.98598 3.91722 9.17431 4.25167 8.3982C4.58611 7.62195 5.05458 6.94001 5.65708 6.35237L6.54813 7.24341C6.03632 7.71036 5.65035 8.2523 5.39021 8.86924C5.13007 9.48619 5 10.1408 5 10.8332C5 12.0554 5.39021 13.1326 6.17063 14.0649C6.95104 14.997 7.94972 15.5672 9.16667 15.7755V17.0255ZM10.8333 17.0415V15.7915C12.0364 15.5479 13.0316 14.9649 13.819 14.0424C14.6063 13.1199 15 12.0501 15 10.8332C15 9.44431 14.5139 8.26376 13.5417 7.29154C12.5694 6.31931 11.3889 5.8332 10 5.8332H9.70521L10.8302 6.9582L9.95188 7.83633L7.32375 5.2082L9.95188 2.58008L10.8302 3.4582L9.70521 4.5832H10C11.7436 4.5832 13.2212 5.18897 14.4327 6.40049C15.6442 7.61202 16.25 9.08959 16.25 10.8332C16.25 12.4015 15.7367 13.7701 14.71 14.939C13.6832 16.1078 12.391 16.8086 10.8333 17.0415Z' fill='%23999999'/></svg>");
          background-repeat: no-repeat;
          background-size: 16px 16px;
          background-position: center;
          pointer-events: none;
        }
      }
    }

    .applied-filters__list {
      display: flex;
      flex-wrap: wrap;
      @include mix.spacer("gap", 3);
    }

    .applied-filter {
      display: flex;
      align-items: center;
      color: var(--color-primary-950);
      border-radius: vars.$border-radius-xxl;
      border: 1px solid var(--color-primary-600);
      white-space: nowrap;
      @include typo.text-small();
      @include mix.p(1, "y");
      @include mix.p(3, "x");

      .remove-filter {
        background: none;
        border: none;
        color: var(--color-primary-950);
        cursor: pointer;
        position: relative;
        width: 8px;
        height: 8px;
        padding: 0;
        text-indent: -9999px;
        @include mix.m(2, "l");

        // Add the SVG as a background
        &::before {
          content: "";
          position: absolute;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          width: 8px;
          height: 8px;
          background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='9' viewBox='0 0 10 9' fill='none'%3E%3Cpath d='M9 0.5L1 8.5M1 0.5L9 8.5' stroke='%23ffffff' stroke-linecap='round'/%3E%3C/svg%3E");
          background-repeat: no-repeat;
          background-position: center;
        }
      }
    }
  }

  .cmp-sidebar__search {
    margin-bottom: 36px;

    .cmp-form__field {
      position: relative;

      .cmp-form__icon {
        position: absolute;
        left: 12px;
        top: 50%;
        transform: translateY(-50%);
        pointer-events: none;

        img {
          display: block;
          width: 20px;
          height: 20px;
        }
      }

      .cmp-form__input {
        width: 100%;
        border: 1px solid var(--color-primary-600);
        border-radius: vars.$border-radius;
        background: var(--color-primary-50);
        color: var(--color-primary-600);
        @include typo.text-display5();
        @include mix.p(3, "y");
        @include mix.p(4, "r");
        @include mix.p(10, "l");

        &:focus {
          outline: none;
        }

        // Style the clear/cross button (X) that appears in search inputs
        &::-webkit-search-cancel-button {
          -webkit-appearance: none;
          appearance: none;
          width: 16px;
          height: 16px;
          background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 16 16' fill='none'%3E%3Cpath d='M12 4L4 12M4 4L12 12' stroke='%23ffffff' stroke-width='2' stroke-linecap='round'/%3E%3C/svg%3E");
          background-repeat: no-repeat;
          background-position: center;
          background-size: 24px 24px;
          cursor: pointer;
        }
      }
    }
  }

  .cmp-sidebar__budget {
    color: var(--color-primary-950);

    .budget-left {
      color: var(--color-primary-700);
      @include typo.text-small();
      @include mix.m(2, "b");
    }

    .budget-center {
      display: flex;
      flex-direction: column;
      @include mix.spacer("gap", 4);

      .budget-inputs {
        display: flex;
        align-items: center;
        @include mix.spacer("gap", 2);
        width: 100%;
        max-width: 100%;

        .budget-value-input {
          flex: 1;
          min-width: 0; // Allows flex items to shrink below their content size
          max-width: calc(50% - 16px); // Ensures inputs don't exceed container
          border-radius: vars.$border-radius;
          border: 1px solid var(--color-primary-600);
          background-color: transparent;
          color: var(--color-primary-950);
          text-align: center;
          @include typo.text-base();
          @include mix.p(1, "y");
          @include mix.p(3, "x");

          &:focus {
            outline: none;
            border-color: var(--color-primary-950);
          }
        }

        .budget-separator {
          flex-shrink: 0;
          align-self: center;
          text-align: center;
          font-weight: 500;
          color: var(--color-primary-700);
          @include typo.text-small();
          padding: 0 4px;
        }
      }

      .budget-range-wrapper {
        position: relative;
        @include mix.m(3, "t");

        .range-labels {
          display: flex;
          justify-content: space-between;
          position: absolute;
          width: 100%;
          color: var(--color-primary-700);
          @include typo.text-xsmall();
          @include mix.m(4, "t");
        }
      }
    }
  }

  .cmp-sidebar__filters {
    margin-top: 64px;

    .cmp-checkbox-list {
      list-style: none;
      display: flex;
      flex-direction: column;
      @include mix.spacer("gap", 2);
      @include mix.m(0);
      @include mix.p(0);
    }

    .cmp-checkbox {
      display: flex;
      align-items: center;
      min-height: 24px; // Ensure consistent height

      label {
        color: var(--color-primary-950);
        cursor: pointer;
        @include typo.text-small();
        @include mix.m(2, "l");
      }
    }
  }
}

.cmp-product-listing {
  display: flex;
  flex-direction: column;
  width: 100%;
  @include mix.m(8, "t");

  /* ---------------- Toolbar ---------------- */
  .cmp-product-toolbar {
    display: flex;
    flex-direction: row;
    justify-content: space-between;
    align-items: center;
    @include mix.spacer("gap", 4);
    @include mix.m(8, "b");

    /* Product count */
    .cmp-product-count {
      color: var(--color-primary-950);
      @include typo.text-small();
    }

    &__sort-wrapper {
      display: flex;
      align-items: center;
      text-align: left;
      @include mix.spacer("gap", 2);

      .cmp-product-sort-label {
        color: var(--color-primary-700);
        white-space: nowrap;
        flex-shrink: 0;
        @include typo.text-small();
        @include mix.m(0, "b");
      }

      /* Select box + filter button */
      .cmp-product-sort {
        display: flex;
        width: 100%;
        @include mix.spacer("gap", 2);

        .cmp-product-filter-trigger {
          display: none;
          flex: 0 0 auto;
          border-radius: vars.$border-radius;
          cursor: pointer;
          color: var(--color-primary-100);
          @include mix.p(2, "y");
          @include mix.p(4, "x");
          @include typo.text-cta();
        }
      }
    }

    @include mix.respond-to("xl", "max") {
      flex-direction: column-reverse;
      align-items: flex-start;
      @include mix.spacer("gap", 8);

      &__sort-wrapper {
        flex-direction: column;
        align-items: flex-start;
        width: 100%;
        @include mix.spacer("gap", 0);

        .cmp-product-sort {
          .choices {
            flex: 1;
          }

          .cmp-product-filter-trigger {
            display: block;
          }
        }
      }
    }
  }

  /* ---------------- Grid ---------------- */
  .cmp-product-grid {
    display: grid;
    grid-template-columns: 1fr;
    width: 100%;
    @include mix.spacer("gap", 5);

    @include mix.respond-to("md", "max") {
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    }

    @include mix.respond-to("lg", "min") {
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    }
  }

  // Hide the "View all" button if there are no more products
  .section-actions-container:not(.has-more) .section-actions-btn {
    display: none;
  }
}

.cmp-accordion__title {
  @include typo.text-display5();
}
.cmp-accordion .cmp-accordion__item .cmp-accordion__button {
  @include mix.p(4, "y");
}

@include mix.respond-to("lg", "max") {
  .spacing-to-top {
    @include mix.m(0, "b");
  }
  .cmp-hero__title {
    @include typo.text-display3();
    @include mix.m(3, "b");
  }

  .cmp-hero__subtitle {
    @include typo.text-small();
  }
}

.sidebar-grid {
  display: grid;
  grid-template-columns: 380px 1fr;
  align-items: start;
  @include mix.spacer("gap", 5);

  @include mix.respond-to("xl") {
    grid-template-columns: 400px 1fr;
  }

  @include mix.respond-to("xl", "max") {
    display: block;

    .cmp-sidebar:not(.dialog-container) {
      display: none;
    }

    .cmp-product-toolbar {
      @include mix.m(5, "b");
    }

    .cmp-product-listing {
      width: 100%;

      .cmp-product-sort-label {
        color: var(--color-primary-700);
        @include typo.text-xsmall();
        @include mix.m(3, "b");
        white-space: nowrap;
      }
    }
  }
}

@include mix.respond-to("lg", "max") {
  .cmp-sidebar {
    display: flex;
    flex-direction: column;
    height: 100vh; // full viewport height
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    overflow-y: auto;
    padding-bottom: 80px; // space for action buttons
    z-index: 9999; // higher z-index to cover header
    border-radius: 0; // remove border radius for full screen
    backdrop-filter: none; // remove backdrop filter for better performance
    @include mix.p(0, "t");
    @include mix.m(0);

    .cmp-mobile--header {
      display: block;
      background: var(--color-primary-base);
      color: var(--color-primary-950);
      text-align: center;
      margin: 0 -2rem;
      width: calc(100% + 3.5rem);
      @include mix.p(3, "t");
      @include mix.p(2, "b");
      @include mix.p(0, "x");
      @include mix.m(5, "b");

      .product-mobile__title {
        @include typo.text-display4();
        @include mix.m(0);
      }
    }

    .cmp-sidebar__info {
      display: none;
    }

    // Only show actions when dialog is open (add .dialog-open class)
    .cmp-sidebar__actions {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--color-primary-base);
      display: flex;
      justify-content: space-between;
      z-index: 10000;
      @include mix.p(4, "t");
      @include mix.p(4, "b");
      @include mix.p(5, "x");
      @include mix.spacer("gap", 3);
      box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.1);

      button {
        flex: 1;
        border-radius: vars.$border-radius;
        cursor: pointer;
        @include mix.p(2, "y");
        @include mix.p(4, "x");
        @include typo.text-cta();
      }

      .btn-cancel {
        background: transparent;
        color: var(--color-primary-950);
        border: 1px solid var(--color-primary-950);
      }

      .btn-apply {
        background: var(--color-primary-950);
        color: var(--color-primary-100);
        border: none;
      }
    }
  }
}
