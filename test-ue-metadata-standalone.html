<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>UE Metadata Test - Standalone</title>
  
  <!-- Page Metadata - Simulating UE values -->
  <meta name="jcr:title" content="UE Metadata Test Page">
  <meta name="jcr:description" content="Testing page and section metadata in Universal Editor">
  <meta name="pageBackgroundColor" content="page-bg-light-grey">
  
  <!-- Inline CSS including all necessary styles -->
  <style>
    /* ASUS Design System Colors */
    :root {
      --color-brand-asus: #0057b7;
      --color-primary: #000000;
      --color-primary-900: #f5f5f5;
      --color-primary-700: #cccccc;
      --color-primary-200: #262626;
      --color-info: #006ce1;
      --color-success: #6fc371;
      --color-warning: #f05f17;
      --color-white: #ffffff;
      --color-black: #000000;
    }

    /* Reset and base styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      line-height: 1.6;
      color: #333;
      background-color: #ffffff;
    }

    /* Page Background Classes */
    body.page-bg-light-grey {
      background-color: var(--color-primary-900);
    }

    body.page-bg-dark {
      background-color: var(--color-primary-200);
      color: var(--color-white);
    }

    body.page-bg-primary {
      background-color: var(--color-brand-asus);
      color: var(--color-white);
    }

    /* Section Background Classes */
    .bg-primary {
      background-color: var(--color-brand-asus) !important;
      color: var(--color-white);
    }

    .bg-white {
      background-color: var(--color-white) !important;
      color: var(--color-primary);
    }

    .bg-black {
      background-color: var(--color-black) !important;
      color: var(--color-white);
    }

    .bg-primary-900 {
      background-color: var(--color-primary-900) !important;
      color: var(--color-primary);
    }

    .bg-primary-700 {
      background-color: var(--color-primary-700) !important;
      color: var(--color-primary);
    }

    .bg-primary-200 {
      background-color: var(--color-primary-200) !important;
      color: var(--color-white);
    }

    .bg-info {
      background-color: var(--color-info) !important;
      color: var(--color-white);
    }

    .bg-success {
      background-color: var(--color-success) !important;
      color: var(--color-white);
    }

    .bg-warning {
      background-color: var(--color-warning) !important;
      color: var(--color-white);
    }

    /* Margin Classes */
    .mt-1 { margin-top: 0.25rem; }
    .mt-4 { margin-top: 1rem; }
    .mt-8 { margin-top: 2rem; }
    .mt-12 { margin-top: 3rem; }
    .mt-16 { margin-top: 4rem; }
    .mt-20 { margin-top: 5rem; }
    .mt-24 { margin-top: 6rem; }

    .mb-1 { margin-bottom: 0.25rem; }
    .mb-4 { margin-bottom: 1rem; }
    .mb-8 { margin-bottom: 2rem; }
    .mb-12 { margin-bottom: 3rem; }
    .mb-16 { margin-bottom: 4rem; }
    .mb-20 { margin-bottom: 5rem; }
    .mb-24 { margin-bottom: 6rem; }

    /* Padding Classes */
    .pt-1 { padding-top: 0.25rem; }
    .pt-4 { padding-top: 1rem; }
    .pt-8 { padding-top: 2rem; }
    .pt-12 { padding-top: 3rem; }
    .pt-16 { padding-top: 4rem; }
    .pt-20 { padding-top: 5rem; }
    .pt-24 { padding-top: 6rem; }

    .pb-1 { padding-bottom: 0.25rem; }
    .pb-4 { padding-bottom: 1rem; }
    .pb-8 { padding-bottom: 2rem; }
    .pb-12 { padding-bottom: 3rem; }
    .pb-16 { padding-bottom: 4rem; }
    .pb-20 { padding-bottom: 5rem; }
    .pb-24 { padding-bottom: 6rem; }

    /* Style Classes */
    .highlight {
      border: 2px solid var(--color-warning);
      box-shadow: 0 0 10px rgba(240, 95, 23, 0.3);
    }

    .text-center {
      text-align: center;
    }

    .full-width {
      width: 100%;
    }

    /* Test page specific styles */
    main {
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem;
    }

    .test-content {
      padding: 2rem;
      margin: 1rem 0;
      border: 2px dashed #ccc;
      min-height: 200px;
    }
    
    .test-info {
      background: #e3f2fd;
      border: 1px solid #2196f3;
      border-radius: 8px;
      padding: 1rem;
      margin: 1rem 0;
    }
    
    .test-info h3 {
      color: #1976d2;
      margin-bottom: 0.5rem;
    }

    .section {
      margin: 2rem 0;
      padding: 1rem;
      border: 1px solid #ddd;
      border-radius: 8px;
    }

    /* Visual indicators for applied classes */
    .section.mt-8 {
      border-top: 4px solid #4caf50;
    }
    
    .section.mb-16 {
      border-bottom: 4px solid #ff9800;
    }
    
    .section.pt-12 {
      border-left: 4px solid #9c27b0;
    }
    
    .section.pb-20 {
      border-right: 4px solid #e91e63;
    }

    .section-metadata {
      display: none; /* Hide metadata in visual display */
    }
  </style>
</head>
<body>
  <main>
    <div class="test-info">
      <h3>üß™ UE Metadata Test Page - Standalone</h3>
      <p><strong>Page Background:</strong> Should have light grey background (check body class)</p>
      <p><strong>Section Tests:</strong> Each section below tests different metadata properties</p>
      <p><strong>Status:</strong> <span id="status">Loading...</span></p>
    </div>

    <!-- Test Section 1: Background Color -->
    <div class="section" id="section1">
      <div class="section-metadata">
        <div>
          <div>Background Color</div>
          <div>bg-primary</div>
        </div>
        <div>
          <div>Name</div>
          <div>Primary Background Test</div>
        </div>
      </div>
      <div class="default-content-wrapper">
        <div class="test-content">
          <h2>Section 1: Background Color Test</h2>
          <p>This section should have a <strong>primary brand background color</strong> (ASUS blue).</p>
          <p>Check the section element for <code>.bg-primary</code> class.</p>
          <p><strong>Applied classes:</strong> <span class="applied-classes"></span></p>
        </div>
      </div>
    </div>

    <!-- Test Section 2: Margins -->
    <div class="section" id="section2">
      <div class="section-metadata">
        <div>
          <div>Background Color</div>
          <div>bg-white</div>
        </div>
        <div>
          <div>Margin Top</div>
          <div>mt-8</div>
        </div>
        <div>
          <div>Margin Bottom</div>
          <div>mb-16</div>
        </div>
        <div>
          <div>Name</div>
          <div>Margins Test</div>
        </div>
      </div>
      <div class="default-content-wrapper">
        <div class="test-content">
          <h2>Section 2: Margins Test</h2>
          <p>This section should have:</p>
          <ul>
            <li><strong>Top margin:</strong> mt-8 (32px) - Green top border indicator</li>
            <li><strong>Bottom margin:</strong> mb-16 (64px) - Orange bottom border indicator</li>
            <li><strong>White background:</strong> bg-white</li>
          </ul>
          <p><strong>Applied classes:</strong> <span class="applied-classes"></span></p>
        </div>
      </div>
    </div>

    <!-- Test Section 3: Padding -->
    <div class="section" id="section3">
      <div class="section-metadata">
        <div>
          <div>Background Color</div>
          <div>bg-primary-900</div>
        </div>
        <div>
          <div>Padding Top</div>
          <div>pt-12</div>
        </div>
        <div>
          <div>Padding Bottom</div>
          <div>pb-20</div>
        </div>
        <div>
          <div>Name</div>
          <div>Padding Test</div>
        </div>
      </div>
      <div class="default-content-wrapper">
        <div class="test-content">
          <h2>Section 3: Padding Test</h2>
          <p>This section should have:</p>
          <ul>
            <li><strong>Top padding:</strong> pt-12 (48px) - Purple left border indicator</li>
            <li><strong>Bottom padding:</strong> pb-20 (80px) - Pink right border indicator</li>
            <li><strong>Light grey background:</strong> bg-primary-900</li>
          </ul>
          <p><strong>Applied classes:</strong> <span class="applied-classes"></span></p>
        </div>
      </div>
    </div>

    <!-- Test Section 4: Multiple Styles -->
    <div class="section" id="section4">
      <div class="section-metadata">
        <div>
          <div>Background Color</div>
          <div>bg-info</div>
        </div>
        <div>
          <div>Style</div>
          <div>highlight, text-center, full-width</div>
        </div>
        <div>
          <div>Margin Top</div>
          <div>mt-4</div>
        </div>
        <div>
          <div>Padding Top</div>
          <div>pt-8</div>
        </div>
        <div>
          <div>Padding Bottom</div>
          <div>pb-8</div>
        </div>
        <div>
          <div>Name</div>
          <div>Combined Styles Test</div>
        </div>
      </div>
      <div class="default-content-wrapper">
        <div class="test-content">
          <h2>Section 4: Combined Styles Test</h2>
          <p>This section should have:</p>
          <ul>
            <li><strong>Info blue background:</strong> bg-info</li>
            <li><strong>Multiple style classes:</strong> highlight, text-center, full-width</li>
            <li><strong>Top margin:</strong> mt-4 (16px)</li>
            <li><strong>Top & bottom padding:</strong> pt-8, pb-8 (32px each)</li>
          </ul>
          <p><strong>Applied classes:</strong> <span class="applied-classes"></span></p>
        </div>
      </div>
    </div>

    <div class="test-info">
      <h3>üîç Verification Results:</h3>
      <p><strong>Body classes:</strong> <span id="body-classes"></span></p>
      <p><strong>Page background working:</strong> <span id="page-bg-status"></span></p>
      <p><strong>Section metadata working:</strong> <span id="section-status"></span></p>
      
      <h4>Before the Fix:</h4>
      <p>‚ùå Section metadata only created data attributes like <code>data-background-color="bg-primary"</code></p>
      
      <h4>After the Fix:</h4>
      <p>‚úÖ Section metadata creates both CSS classes <code>class="section bg-primary mt-8"</code> AND data attributes</p>
    </div>
  </main>

  <script>
    // Inline JavaScript to simulate the metadata processing functionality
    
    // Function to get metadata from meta tags
    function getMetadata(name) {
      const attr = name && name.includes(':') ? 'property' : 'name';
      const meta = document.querySelector(`meta[${attr}="${name}"]`);
      return meta ? meta.content : '';
    }

    // Function to extract config from section metadata
    function readBlockConfig(block) {
      const config = {};
      block.querySelectorAll(':scope > div').forEach((row) => {
        if (row.children && row.children.length >= 2) {
          const name = row.children[0].textContent.trim().toLowerCase().replace(/\s+/g, '');
          const value = row.children[1].textContent.trim();
          config[name] = value;
        }
      });
      return config;
    }

    // Function to convert name to camelCase
    function toCamelCase(name) {
      return name.replace(/-([a-z])/g, (g) => g[1].toUpperCase());
    }

    // Function to process section metadata
    function processSectionMetadata(section) {
      const sectionMeta = section.querySelector('div.section-metadata');
      if (sectionMeta) {
        const meta = readBlockConfig(sectionMeta);
        
        // Fields that should be applied as CSS classes
        const cssClassFields = ['backgroundcolor', 'margintop', 'marginbottom', 'paddingtop', 'paddingbottom', 'style'];
        
        Object.keys(meta).forEach((key) => {
          if (cssClassFields.includes(key)) {
            if (key === 'style') {
              // Handle multiselect style field
              const styles = meta.style.split(',').filter(s => s.trim()).map(s => s.trim());
              styles.forEach((style) => section.classList.add(style));
            } else {
              // Handle single CSS class fields
              if (meta[key] && meta[key].trim()) {
                section.classList.add(meta[key].trim());
              }
            }
          } else {
            // Other metadata fields become data attributes
            section.dataset[toCamelCase(key)] = meta[key];
          }
        });
      }
    }

    // Main initialization function
    function init() {
      console.log('Initializing metadata test...');
      
      // Apply page background
      const pageBackgroundColor = getMetadata('pageBackgroundColor');
      console.log('Page background color:', pageBackgroundColor);
      
      if (pageBackgroundColor) {
        document.body.classList.add(pageBackgroundColor);
      }

      // Process all sections
      const sections = document.querySelectorAll('.section');
      sections.forEach(processSectionMetadata);

      // Update status display
      document.getElementById('status').textContent = 'Initialized ‚úÖ';
      document.getElementById('body-classes').textContent = document.body.className || 'none';
      document.getElementById('page-bg-status').textContent = pageBackgroundColor ? '‚úÖ Working' : '‚ùå Not set';

      // Display applied classes for each section
      sections.forEach((section, index) => {
        const classesSpan = section.querySelector('.applied-classes');
        if (classesSpan) {
          classesSpan.textContent = section.className || 'none';
        }
      });

      // Check if section metadata is working
      const sectionsWithBg = document.querySelectorAll('.section[class*="bg-"]');
      document.getElementById('section-status').textContent = sectionsWithBg.length > 0 ? '‚úÖ Working' : '‚ùå Not working';

      console.log('Body classes:', document.body.className);
      sections.forEach((section, index) => {
        console.log(`Section ${index + 1} classes:`, section.className);
      });
    }

    // Initialize when DOM is ready
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
